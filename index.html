<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 1.0.0">
<meta name="crystal_docs.project_version" content="0.8.1">
<meta name="crystal_docs.project_name" content="anyolite">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="anyolite">
  <title>anyolite 0.8.1</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          anyolite
        </a>
      </h1>

      <span class="project-version">
        0.8.1
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class=" " data-id="anyolite/MrbCast" data-name="mrbcast">
      <a href="MrbCast.html">MrbCast</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbClass" data-name="mrbclass">
      <a href="MrbClass.html">MrbClass</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbClassCache" data-name="mrbclasscache">
      <a href="MrbClassCache.html">MrbClassCache</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbFunc" data-name="mrbfunc">
      <a href="MrbFunc.html">MrbFunc</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbMacro" data-name="mrbmacro">
      <a href="MrbMacro.html">MrbMacro</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbModule" data-name="mrbmodule">
      <a href="MrbModule.html">MrbModule</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbRefTable" data-name="mrbreftable">
      <a href="MrbRefTable.html">MrbRefTable</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbState" data-name="mrbstate">
      <a href="MrbState.html">MrbState</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbTypeCache" data-name="mrbtypecache">
      <a href="MrbTypeCache.html">MrbTypeCache</a>
      
    </li>
  
  <li class="parent " data-id="anyolite/MrbWrap" data-name="mrbwrap">
      <a href="MrbWrap.html">MrbWrap</a>
      
        <ul>
  
  <li class=" " data-id="anyolite/MrbWrap/Empty" data-name="mrbwrap::empty">
      <a href="MrbWrap/Empty.html">Empty</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/Exclude" data-name="mrbwrap::exclude">
      <a href="MrbWrap/Exclude.html">Exclude</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/ExcludeClassMethod" data-name="mrbwrap::excludeclassmethod">
      <a href="MrbWrap/ExcludeClassMethod.html">ExcludeClassMethod</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/ExcludeConstant" data-name="mrbwrap::excludeconstant">
      <a href="MrbWrap/ExcludeConstant.html">ExcludeConstant</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/ExcludeInstanceMethod" data-name="mrbwrap::excludeinstancemethod">
      <a href="MrbWrap/ExcludeInstanceMethod.html">ExcludeInstanceMethod</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/Interpreted" data-name="mrbwrap::interpreted">
      <a href="MrbWrap/Interpreted.html">Interpreted</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/Rename" data-name="mrbwrap::rename">
      <a href="MrbWrap/Rename.html">Rename</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/RenameClass" data-name="mrbwrap::renameclass">
      <a href="MrbWrap/RenameClass.html">RenameClass</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/RenameClassMethod" data-name="mrbwrap::renameclassmethod">
      <a href="MrbWrap/RenameClassMethod.html">RenameClassMethod</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/RenameConstant" data-name="mrbwrap::renameconstant">
      <a href="MrbWrap/RenameConstant.html">RenameConstant</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/RenameInstanceMethod" data-name="mrbwrap::renameinstancemethod">
      <a href="MrbWrap/RenameInstanceMethod.html">RenameInstanceMethod</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/RenameModule" data-name="mrbwrap::renamemodule">
      <a href="MrbWrap/RenameModule.html">RenameModule</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/Specialize" data-name="mrbwrap::specialize">
      <a href="MrbWrap/Specialize.html">Specialize</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/SpecializeClassMethod" data-name="mrbwrap::specializeclassmethod">
      <a href="MrbWrap/SpecializeClassMethod.html">SpecializeClassMethod</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/SpecializeInstanceMethod" data-name="mrbwrap::specializeinstancemethod">
      <a href="MrbWrap/SpecializeInstanceMethod.html">SpecializeInstanceMethod</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/SpecifyGenericTypes" data-name="mrbwrap::specifygenerictypes">
      <a href="MrbWrap/SpecifyGenericTypes.html">SpecifyGenericTypes</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/StructWrapper" data-name="mrbwrap::structwrapper(t)">
      <a href="MrbWrap/StructWrapper.html">StructWrapper</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/Undefined" data-name="mrbwrap::undefined">
      <a href="MrbWrap/Undefined.html">Undefined</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/WrapWithoutKeywords" data-name="mrbwrap::wrapwithoutkeywords">
      <a href="MrbWrap/WrapWithoutKeywords.html">WrapWithoutKeywords</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/WrapWithoutKeywordsClassMethod" data-name="mrbwrap::wrapwithoutkeywordsclassmethod">
      <a href="MrbWrap/WrapWithoutKeywordsClassMethod.html">WrapWithoutKeywordsClassMethod</a>
      
    </li>
  
  <li class=" " data-id="anyolite/MrbWrap/WrapWithoutKeywordsInstanceMethod" data-name="mrbwrap::wrapwithoutkeywordsinstancemethod">
      <a href="MrbWrap/WrapWithoutKeywordsInstanceMethod.html">WrapWithoutKeywordsInstanceMethod</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="anyolite" class="anchor" href="#anyolite">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Anyolite</h1>

<p>Anyolite is a Crystal shard which adds a fully functional mruby interpreter to Crystal.</p>

<p><img src="https://github.com/Anyolite/anyolite/workflows/Test/badge.svg" alt="Test"/></p>

<p><img src="https://img.shields.io/github/v/release/Anyolite/anyolite" alt="Release"/>
<img src="https://img.shields.io/github/release-date/Anyolite/anyolite" alt="ReleaseDate"/></p>

<p><img src="https://img.shields.io/github/license/Anyolite/anyolite" alt="License"/></p>

<h1><a id="description" class="anchor" href="#description">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Description</h1>

<p>Anyolite allows for wrapping Crystal classes and functions into mruby with little effort.
This way, mruby can be used as a scripting language to Crystal projects, with the major advantage of a similar syntax.</p>

<p>This project is currently in active development, so please report any bugs or missing relevant features.</p>

<h1><a id="features" class="anchor" href="#features">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Features</h1>

<ul><li>Bindings to an mruby interpreter</li><li>Wrapping of nearly arbitrary Crystal classes and methods to mruby</li><li>Easy syntax without unnecessary boilerplate code</li><li>Simple system to prevent garbage collector conflicts</li><li>Support for keyword arguments and default values</li><li>Objects, structs, enums and unions as function arguments and return values are completely valid</li><li>Methods and constants can be excluded, modified or renamed with annotations</li></ul>

<h1><a id="prerequisites" class="anchor" href="#prerequisites">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Prerequisites</h1>

<p>You need to have the following programs installed (and in your PATH variable, if you are on Windows):</p>

<ul><li>Ruby (for building mruby)</li><li>Rake (for building the whole project)</li><li>Bison (for building mruby)</li><li>Git (for downloading mruby)</li><li>GCC or Microsoft Visual Studio 19 (for building the object files required for Anyolite, depending on your OS)</li></ul>

<h1><a id="installing" class="anchor" href="#installing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installing</h1>

<p>Put this shard as a requirement into your shard.yml project file and then call</p>

<pre><code class="language-bash">shards install</code></pre>

<p>from a terminal or the MSVC Developer Console (on Windows).</p>

<p>Alternatively, you can clone this repository into the lib folder of your project and run</p>

<pre><code class="language-bash">rake build_shard</code></pre>

<p>manually to install the shard without using the crystal shards program.</p>

<p>If you want to use other options for Anyolite, you can set <code>ANYOLITE_CONFIG_PATH</code> to the filename of a JSON config file,
which allows for changing multiple options when installing the shard. Possible options are:</p>

<ul><li><code>ANYOLITE_BUILDPATH</code> - The relative directory in which Anyolite will be built</li><li><code>ANYOLITE_MRUBY_FORK</code> - The web address of the mruby repository</li><li><code>ANYOLITE_MRUBY_RELEASE</code> - The release tag of the mruby version to be used</li><li><code>ANYOLITE_MRUBY_DIR</code> - The relative directory mruby will be installed in</li><li><code>ANYOLITE_MRUBY_CONFIG_PATH</code> - The config file which is used for building mruby</li><li><code>ANYOLITE_COMPILER</code> - The C compiler used for building Anyolite</li></ul>

<h1><a id="how-to-use" class="anchor" href="#how-to-use">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>How to use</h1>

<p>Imagine a Crystal class for a really bad RPG:</p>

<pre><code class="language-crystal"><span class="k">module</span> <span class="t">TestModule</span>
  <span class="k">class</span> <span class="t">Entity</span>
    property hp : <span class="t">Int32</span> <span class="o">=</span> <span class="n">0</span>

    <span class="k">def</span> <span class="m">initialize</span>(@hp)
    <span class="k">end</span>

    <span class="k">def</span> <span class="m">damage</span>(diff : <span class="t">Int32</span>)
      @hp -= diff
    <span class="k">end</span>

    <span class="k">def</span> <span class="m">yell</span>(sound : <span class="t">String</span>, loud : <span class="t">Bool</span> <span class="o">=</span> <span class="n">false</span>)
      <span class="k">if</span> loud
        puts <span class="s">&quot;Entity yelled: </span><span class="i">#{</span>sound.upcase<span class="i">}</span><span class="s">&quot;</span>
      <span class="k">else</span>
        puts <span class="s">&quot;Entity yelled: </span><span class="i">#{</span>sound<span class="i">}</span><span class="s">&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="m">absorb_hp_from</span>(other : <span class="t">Entity</span>)
      @hp += other.hp
      other.hp <span class="o">=</span> <span class="n">0</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>Now, you want to wrap this class in Ruby. All you need to do is to execute the following code in Crystal (current commit; see documentation page for the version of the latest release):</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;anyolite&quot;</span>

<span class="t">MrbState</span>.create <span class="k">do</span> <span class="o">|</span>mrb<span class="o">|</span>
  <span class="t">MrbWrap</span>.wrap(mrb, <span class="t">TestModule</span>)

  mrb.load_script_from_file(<span class="s">&quot;examples/hp_example.rb&quot;</span>)
<span class="k">end</span></code></pre>

<p>Well, that's it already. 
The last line in the block calls the following example script:</p>

<pre><code class="language-ruby">a = TestModule::Entity.new(hp: 20)
a.damage(diff: 13)
puts a.hp

b = TestModule::Entity.new(hp: 10)
a.absorb_hp_from(other: b)
puts a.hp
puts b.hp
b.yell(sound: 'Ouch, you stole my HP!', loud: true)
a.yell(sound: 'Well, take better care of your public attributes!')</code></pre>

<p>The example above gives a good overview over the things you can already do with Anyolite.
More features will be added in the future.</p>

<h1><a id="limitations" class="anchor" href="#limitations">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Limitations</h1>

<ul><li>Currently, Anyolite does not work on Windows due to Crystal compiler bugs</li><li>Arrays and hashes are not directly supported</li><li>Symbols do not work due to their compiletime nature in Crystal</li><li>Splat arguments and arbitrary keywords are not possible due to their reliance on symbols</li><li>Keywords will always be given to functions, even if optional (then with default values)</li><li>Non-keyword function arguments are always set to their default values before receiving their final values</li><li>Default arguments need to be specialized with their full class and module path in order to work</li><li>Private constants need to be excluded in order to prevent errors</li></ul>

<h1><a id="why-this-name" class="anchor" href="#why-this-name">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Why this name?</h1>

<p>https://en.wikipedia.org/wiki/Anyolite</p>

<p>In short, it is a rare variant of the crystalline mineral called zoisite, with ruby and other crystal shards (of pargasite) embedded.</p>

<p>The term 'anyoli' means 'green' in the Maasai language, thus naming 'anyolite'.</p>

<h1><a id="roadmap" class="anchor" href="#roadmap">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Roadmap</h1>

<h2><a id="upcoming-releases" class="anchor" href="#upcoming-releases">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Upcoming releases</h2>

<h3><a id="version-0.9.0" class="anchor" href="#version-0.9.0">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Version 0.9.0</h3>

<h4><a id="features" class="anchor" href="#features">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Features</h4>

<ul><li>[ ] Additional compatibility layer between Anyolite and mruby</li><li>[ ] More configuration options</li></ul>

<h4><a id="breaking-changes" class="anchor" href="#breaking-changes">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Breaking changes</h4>

<ul><li>[ ] Rename <code><a href="MrbWrap.html">MrbWrap</a></code> to <code>Anyolite</code></li><li>[ ] Rename <code><a href="MrbMacro.html">MrbMacro</a></code> to <code>Anyolite::Macro</code></li><li>[ ] Rename <code>mrb</code> and <code>mruby</code> in the code to <code>rb</code> and <code>ruby</code></li><li>[ ] Rework configurations for the Rakefile into a class</li></ul>

<h4><a id="usability" class="anchor" href="#usability">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Usability</h4>

<ul><li>[ ] Split macro source file into smaller parts</li><li>[ ] Update documentation to new code</li></ul>

<h3><a id="version-0.10.0" class="anchor" href="#version-0.10.0">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Version 0.10.0</h3>

<p>This version is planned to be the last feature release before 1.0.0.
Currently, the way its features are going to be implemented is not yet determined,
so it will probably take some time before it will be released.</p>

<ul><li>[ ] Options for inherited and/or inheriting classes</li></ul>

<h3><a id="version-1.0.0" class="anchor" href="#version-1.0.0">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Version 1.0.0</h3>

<ul><li>[ ] Windows support (currently not supported due to problems with Crystal)</li><li>[ ] Crystal specs for testing</li><li>[ ] Documentation of all relevant features and wrappers</li><li>[ ] Mac support (might be possible, not tested yet)</li><li>[ ] More configuration options for the Rakefile</li></ul>

<h3><a id="future-ideas-might-not-actually-be-possible-to-implement" class="anchor" href="#future-ideas-might-not-actually-be-possible-to-implement">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Future ideas (might not actually be possible to implement)</h3>

<ul><li>[ ] Arrays and/or hashes as argument and return values</li><li>[ ] Splat argument and/or arbitrary keyword passing</li><li>[ ] Method in mruby to determine owner of object</li><li>[ ] Support for procs and/or pointers</li></ul>


</div>
</body>
</html>
